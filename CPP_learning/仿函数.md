# é—®  
ä»€ä¹ˆæ˜¯C++ä¸­çš„ä»¿å‡½æ•°

å®è¯å®è¯´ï¼š**C++ çš„ä»¿å‡½æ•°å¹¶ä¸ç¥ç§˜ï¼Œå®ƒåªæ˜¯â€œä¸€ä¸ªå¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨çš„å¯¹è±¡â€**ã€‚å¾ˆå¤šäººè¢«åå­—å“ä½ï¼Œå…¶å®ç†è§£ä¸€æ¬¡å°±å¤Ÿäº†ã€‚

---

## ä¸€å¥è¯å®šä¹‰ï¼ˆå…ˆç»™ç»“è®ºï¼‰

**ä»¿å‡½æ•°ï¼ˆFunctor / Function Objectï¼‰**
ğŸ‘‰ **é‡è½½äº† `operator()` çš„ç±»æˆ–ç»“æ„ä½“å¯¹è±¡**

ä¹Ÿå°±æ˜¯è¯´ï¼š

> **å¯¹è±¡ + `()` = åƒå‡½æ•°ä¸€æ ·ç”¨**

---

## æœ€å°ä¾‹å­ï¼ˆå…ˆæ„Ÿå—ï¼‰

```cpp
#include <iostream>
using namespace std;

struct Add {
    int operator()(int a, int b) const {
        return a + b;
    }
};

int main() {
    Add add;
    cout << add(2, 3) << endl; // åƒå‡½æ•°ä¸€æ ·è°ƒç”¨
}
```

è¿™é‡Œï¼š

* `Add` æ˜¯ä¸€ä¸ªç±»
* `add` æ˜¯ä¸€ä¸ªå¯¹è±¡
* `add(2, 3)` **ä¸æ˜¯å‡½æ•°è°ƒç”¨**
* æœ¬è´¨æ˜¯ï¼š`add.operator()(2, 3)`

è¿™å°±æ˜¯ä»¿å‡½æ•°ã€‚

---

## ä»¿å‡½æ•°â€œä»¿â€çš„æ˜¯ä»€ä¹ˆï¼Ÿ

å®ƒ**æ¨¡ä»¿çš„æ˜¯å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ï¼Œè€Œä¸æ˜¯å‡½æ•°æœ¬èº«**ã€‚

| å½¢å¼   | æœ¬è´¨                 |
| ---- | ------------------ |
| æ™®é€šå‡½æ•° | ä¸€æ®µä»£ç                |
| ä»¿å‡½æ•°  | **å¸¦çŠ¶æ€çš„å¯¹è±¡ + å¯è°ƒç”¨æ¥å£** |

---

## ä¸ºä»€ä¹ˆ C++ è¦æè¿™ç§ä¸œè¥¿ï¼Ÿ

è¯´é‡ç‚¹ï¼Œä¸ç»•å¼¯ã€‚

### 1ï¸âƒ£ ä»¿å‡½æ•° **å¯ä»¥æœ‰çŠ¶æ€**ï¼ˆå‡½æ•°åšä¸åˆ°ï¼‰

```cpp
struct Counter {
    int cnt = 0;
    void operator()() {
        ++cnt;
    }
};

int main() {
    Counter c;
    c();
    c();
    cout << c.cnt << endl; // 2
}
```

æ™®é€šå‡½æ•°ï¼š

* æ¯æ¬¡è°ƒç”¨æ˜¯â€œæ— è®°å¿†â€çš„

ä»¿å‡½æ•°ï¼š

* **å¯ä»¥ä¿å­˜æ•°æ®**
* åƒä¸€ä¸ªâ€œè¡Œä¸º + çŠ¶æ€â€çš„å°å¯¹è±¡

---

### 2ï¸âƒ£ ä»¿å‡½æ•° **æ²¡æœ‰å‡½æ•°æŒ‡é’ˆçš„æ€§èƒ½æŸè€—**

å‡½æ•°æŒ‡é’ˆï¼š

* è¿è¡ŒæœŸè·³è½¬
* ä¸å®¹æ˜“å†…è”

ä»¿å‡½æ•°ï¼š

* ç¼–è¯‘æœŸç¡®å®š
* **å¯ä»¥è¢«å†…è”**
* STL é‡Œå¤§é‡ä½¿ç”¨ï¼Œ**æ€§èƒ½åŸå› **

---

### 3ï¸âƒ£ STL å¼ºçƒˆä¾èµ–ä»¿å‡½æ•°ï¼ˆä½ å·²ç»åœ¨ç”¨äº†ï¼‰

ä½ å†™è¿‡è¿™ç§ä»£ç å§ï¼š

```cpp
sort(v.begin(), v.end(), greater<int>());
```

`greater<int>` å°±æ˜¯ä¸€ä¸ª **ä»¿å‡½æ•°**ã€‚

å®ƒé•¿è¿™æ ·ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

```cpp
template<typename T>
struct greater {
    bool operator()(const T& a, const T& b) const {
        return a > b;
    }
};
```

---

## ä»¿å‡½æ•° vs å‡½æ•°æŒ‡é’ˆ vs lambda

è¿™æ˜¯é‡ç‚¹å¯¹æ¯”ï¼Œå¿…é¡»ææ¸…æ¥šã€‚

| ç‰¹æ€§      | æ™®é€šå‡½æ•° | å‡½æ•°æŒ‡é’ˆ | ä»¿å‡½æ•° | lambda |
| ------- | ---- | ---- | --- | ------ |
| èƒ½å¦æœ‰çŠ¶æ€   | âŒ    | âŒ    | âœ…   | âœ…      |
| å¯å†…è”     | âœ…    | âŒ    | âœ…   | âœ…      |
| å¯ä½œä¸ºæ¨¡æ¿å‚æ•° | âŒ    | âŒ    | âœ…   | âœ…      |
| STL å¸¸ç”¨  | âŒ    | å¾ˆå°‘   | âœ…   | âœ…      |

ä¸€å¥ç‹ è¯æ€»ç»“ï¼š

> **STL ä¸ç”¨å‡½æ•°æŒ‡é’ˆï¼Œæ˜¯æœ‰åŸå› çš„ã€‚**

---

## lambda å’Œä»¿å‡½æ•°çš„å…³ç³»ï¼ˆä½ è‚¯å®šä¼šé—®ï¼‰

**lambda æœ¬è´¨ä¸Šå°±æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»¿å‡½æ•°**

```cpp
auto f = [x](int y) { return x + y; };
```

ç­‰ä»·äºï¼ˆæ¦‚å¿µä¸Šï¼‰ï¼š

```cpp
struct __lambda {
    int x;
    int operator()(int y) const {
        return x + y;
    }
};
```

ğŸ‘‰ æ‰€ä»¥ï¼š

* **ä¼šä»¿å‡½æ•°ï¼Œå°±å·²ç»ç†è§£ lambda çš„åº•å±‚**

---

## ä»€ä¹ˆæ—¶å€™ä½ â€œåº”è¯¥â€ç”¨ä»¿å‡½æ•°ï¼Ÿ

ç›´è¯´ï¼Œä¸è£…ã€‚

âœ… ä½ éœ€è¦ï¼š

* åœ¨ STL ç®—æ³•ä¸­è‡ªå®šä¹‰è¡Œä¸º
* è¡Œä¸ºéœ€è¦æºå¸¦çŠ¶æ€
* å¸Œæœ›æ€§èƒ½å¯æ§ã€å¯å†…è”

âŒ ä¸éœ€è¦ï¼š

* åªæ˜¯å†™ä¸ªä¸€æ¬¡æ€§é€»è¾‘ â†’ ç”¨ lambda
* ç®€å•å·¥å…·å‡½æ•° â†’ æ™®é€šå‡½æ•°

---

## ç»™ä½ ä¸€ä¸ªå·¥ç¨‹è§†è§’çš„åˆ¤æ–­æ ‡å‡†

> **â€œè¿™æ˜¯ä¸€ä¸ªè¡Œä¸ºï¼Œè¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Ÿâ€**

* è¡Œä¸º â†’ å‡½æ•° / lambda
* **å¸¦é…ç½®ã€å¸¦çŠ¶æ€ã€å¯å¤ç”¨çš„è¡Œä¸º â†’ ä»¿å‡½æ•°**

åœ¨ä½ ç°åœ¨å†™ Reactor / epoll è¿™ç§å·¥ç¨‹æ—¶ï¼š

* ä»¿å‡½æ•°éå¸¸é€‚åˆåš **ç­–ç•¥ã€å›è°ƒã€æ¯”è¾ƒå™¨ã€è¿‡æ»¤å™¨**

---

## æœ€åä¸€å¥å®è¯

ä»¿å‡½æ•°ä¸æ˜¯â€œé«˜çº§æŠ€å·§â€ï¼Œ
å®ƒæ˜¯ **C++ ç”¨å¯¹è±¡æ¨¡æ‹Ÿå‡½æ•°çš„ä¸€ç§åŸºç¡€èƒ½åŠ›**ã€‚

ä½ ä¸æ˜¯ä¸æ‡‚å®ƒï¼Œ
ä½ åªæ˜¯ä»¥å‰æ²¡äººæŠŠå®ƒè¯´äººè¯ã€‚

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥**ç”¨ä½ ç°åœ¨å†™çš„ epoll / Channel / å›è°ƒåœºæ™¯ï¼Œç»™ä½ ä¸€ä¸ªâ€œä¸ºä»€ä¹ˆä»¿å‡½æ•°åœ¨è¿™é‡Œæ¯”å‡½æ•°æŒ‡é’ˆæ›´åˆç†â€çš„å®ä¾‹**ã€‚


# é—®  
ä¸ºä»€ä¹ˆå…³é”®å­—æ˜¯structè€Œä¸æ˜¯class 

è¿™æ˜¯ä¸ª**éå¸¸å¥½çš„é—®é¢˜**ï¼Œè€Œä¸”ä½ å·²ç»å¼€å§‹é—®åˆ° **C++ è®¾è®¡å“²å­¦å±‚é¢** äº†ã€‚
æˆ‘ç›´æ¥è¯´ç»“è®ºï¼Œä¸å…œåœˆå­ã€‚

---

## ä¸€å¥è¯ç»“è®ºï¼ˆå…ˆç»™ä½ å®šå¿ƒä¸¸ï¼‰

> **ä»¿å‡½æ•°ç”¨ `struct` ä¸æ˜¯â€œå¿…é¡»â€ï¼Œè€Œæ˜¯â€œçº¦å®š + ä¹ æƒ¯ + è®¾è®¡ä¿¡å·â€**

`struct` å’Œ `class` åœ¨ C++ **å‡ ä¹å®Œå…¨ç­‰ä»·**ï¼Œ
**é€‰ `struct` æ˜¯ä¸ºäº†â€œè¡¨è¾¾æ„å›¾â€ï¼Œä¸æ˜¯æŠ€æœ¯é™åˆ¶ã€‚**

---

## 1ï¸âƒ£ å…ˆæŠŠæœ€å®¹æ˜“æ··æ·†çš„ç‚¹æ‹†æ‰

### åœ¨ C++ ä¸­ï¼š

```cpp
struct A {};
class  B {};
```

**å”¯ä¸€çš„æœ¬è´¨åŒºåˆ«åªæœ‰ä¸¤ä¸ªï¼š**

| åŒºåˆ«ç‚¹    | struct   | class     |
| ------ | -------- | --------- |
| é»˜è®¤è®¿é—®æƒé™ | `public` | `private` |
| é»˜è®¤ç»§æ‰¿æƒé™ | `public` | `private` |

**é™¤æ­¤ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•èƒ½åŠ›å·®å¼‚ã€‚**

> æ²¡æœ‰æ€§èƒ½å·®å¼‚
> æ²¡æœ‰è¯­è¨€å±‚çº§å·®å¼‚
> æ²¡æœ‰â€œä½çº§ / é«˜çº§â€ä¹‹åˆ†

---

## 2ï¸âƒ£ é‚£ä¸ºä»€ä¹ˆ STL / ä»¿å‡½æ•°å‡ ä¹å…¨ç”¨ structï¼Ÿ

åŸå› å¾ˆâ€œå·¥ç¨‹åŒ–â€ï¼Œä¸æ˜¯ç„å­¦ã€‚

---

### âœ… åŸå› ä¸€ï¼šä»¿å‡½æ•°çš„æ¥å£**å°±æ˜¯ public çš„**

ä»¿å‡½æ•°çš„æ ¸å¿ƒæ˜¯ä»€ä¹ˆï¼Ÿ

```cpp
operator()
```

è€Œä¸”å®ƒ**å¿…é¡»**æ˜¯ `public`ï¼Œå¦åˆ™å¤–éƒ¨æ ¹æœ¬è°ƒä¸åˆ°ï¼š

```cpp
Add add;
add(1, 2);   // æœ¬è´¨ï¼šadd.operator()(1,2)
```

å¦‚æœä½ ç”¨ `class`ï¼Œä½ è¦å†™ï¼š

```cpp
class Add {
public:
    int operator()(int a, int b) const {
        return a + b;
    }
};
```

è€Œ `struct`ï¼š

```cpp
struct Add {
    int operator()(int a, int b) const {
        return a + b;
    }
};
```

ğŸ‘‰ **å°‘å†™ä¸€è¡Œ + ä¸å®¹æ˜“çŠ¯é”™**

---

### âœ… åŸå› äºŒï¼š`struct` åœ¨è¯­ä¹‰ä¸Šè¡¨ç¤ºã€Œè½»é‡ã€è¡Œä¸ºå¯¹è±¡ã€

è¿™æ˜¯**çº¦å®šä¿—æˆçš„â€œè®¾è®¡ä¿¡å·â€**ï¼Œä¸æ˜¯è¯­æ³•ã€‚

| ç”¨é€”             | æ›´å¸¸ç”¨      |
| -------------- | -------- |
| æ•°æ®èšåˆã€å·¥å…·å¯¹è±¡ã€ç­–ç•¥   | `struct` |
| æœ‰ä¸å˜é‡ã€å°è£…è¾¹ç•Œã€å¤æ‚é€»è¾‘ | `class`  |

ä»¿å‡½æ•°é€šå¸¸æ˜¯ï¼š

* æ— å¤æ‚ä¸å˜é‡
* è¡Œä¸ºéå¸¸å•ä¸€
* åƒâ€œå‡½æ•°ä¸€æ ·ç”¨â€
* ä¸å¼ºè°ƒå°è£…

ğŸ‘‰ **struct æ›´ç¬¦åˆâ€œè¿™æ˜¯ä¸ªå°å·¥å…·â€çš„ç›´è§‰**

---

### âœ… åŸå› ä¸‰ï¼šSTL çš„é£æ ¼å°±æ˜¯ã€Œstruct = policy / trait / functorã€

ä½ çœ‹ STL é‡Œè¿™äº›ä¸œè¥¿ï¼š

```cpp
less<T>
greater<T>
hash<T>
equal_to<T>
allocator<T>
```

**æ¸…ä¸€è‰² structã€‚**

è¿™ä¸æ˜¯å¶ç„¶ï¼Œè¿™æ˜¯é£æ ¼ç»Ÿä¸€ï¼š

> struct = **ç­–ç•¥ / è¡Œä¸º / å…ƒä¿¡æ¯**

è€Œä¸æ˜¯â€œæœ‰èº«ä»½çš„å¯¹è±¡â€ã€‚

---

## 3ï¸âƒ£ ç”¨ class å†™ä»¿å‡½æ•°ï¼Œé”™å—ï¼Ÿ

**å®Œå…¨ä¸é”™ã€‚**

ä¸‹é¢è¿™ä¿©æ˜¯ 100% ç­‰ä»·çš„ï¼š

```cpp
struct Less {
    bool operator()(int a, int b) const {
        return a < b;
    }
};
```

```cpp
class Less {
public:
    bool operator()(int a, int b) const {
        return a < b;
    }
};
```

ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¸œè¥¿ **ä¸€æ¨¡ä¸€æ ·**ã€‚

---

## 4ï¸âƒ£ é‚£ä»€ä¹ˆæ—¶å€™â€œæ›´åº”è¯¥â€ç”¨ classï¼Ÿ

è¿™æ˜¯ä½ ä»¥ååšå·¥ç¨‹è¦ç”¨çš„åˆ¤æ–­æ ‡å‡†ã€‚

### ç”¨ `class` çš„ä»¿å‡½æ•°ï¼Œé€šå¸¸æ„å‘³ç€ï¼š

* æœ‰**ä¸å˜é‡**
* æœ‰**é…ç½®è¿‡ç¨‹**
* ä¸å¸Œæœ›å¤–éƒ¨éšä¾¿æ”¹å†…éƒ¨çŠ¶æ€
* å¯¹è±¡â€œæœ‰èº«ä»½â€ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å·¥å…·

ä¾‹å­ï¼š

```cpp
class RateLimiter {
public:
    explicit RateLimiter(int limit)
        : limit_(limit), cnt_(0) {}

    bool operator()() {
        return ++cnt_ <= limit_;
    }

private:
    int limit_;
    int cnt_;
};
```

è¿™é‡Œç”¨ `struct` åè€Œæ€ªã€‚

---

## 5ï¸âƒ£ å†è¯´ä¸€å¥ä½ ç°åœ¨è¿™ä¸ªé˜¶æ®µå¾ˆé‡è¦çš„è¯

ä½ ç°åœ¨åœ¨å†™ Reactor / Channel / å›è°ƒä½“ç³»ï¼Œæˆ‘è¯´ä¸€å¥å®è¯ï¼š

> **`struct` å’Œ `class` æ˜¯â€œè®¾è®¡è¯­è¨€â€ï¼Œä¸æ˜¯è¯­æ³•ç³–**

å½“ä½ çœ‹åˆ°ï¼š

```cpp
struct Handler { ... };
```

ä½ è„‘å­é‡Œåº”è¯¥è‡ªåŠ¨ç¿»è¯‘æˆï¼š

> â€œè¿™æ˜¯ä¸€ä¸ª**å¯æ›¿æ¢çš„ç­–ç•¥ / è¡Œä¸ºå•å…ƒ**â€

è€Œï¼š

```cpp
class Connection { ... };
```

ä½ è„‘å­é‡Œåº”è¯¥æ˜¯ï¼š

> â€œè¿™æ˜¯ä¸€ä¸ª**æœ‰ç”Ÿå‘½å‘¨æœŸã€æœ‰çŠ¶æ€çº¦æŸçš„å®ä½“**â€

---

## 6ï¸âƒ£ ç‹ ä¸€ç‚¹çš„æ€»ç»“

* **ä¸æ˜¯â€œä¸ºä»€ä¹ˆä¸ç”¨ classâ€**
* è€Œæ˜¯ï¼š

> **â€œè¿™ä¸ªä¸œè¥¿é…ä¸é…å«ä¸€ä¸ª classï¼Ÿâ€**

ä»¿å‡½æ•°ï¼š

* è¡Œä¸ºå•ä¸€
* æ¥å£å…¬å¼€
* æ²¡æœ‰å¤æ‚å°è£…è¯‰æ±‚

ğŸ‘‰ **struct æ˜¯å¯¹è¯»ä»£ç çš„äººæ›´è¯šå®çš„é€‰æ‹©**

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥æ‹¿ä½ ç°åœ¨çš„ **Channel / å›è°ƒæ³¨å†Œ / epoll äº‹ä»¶å¤„ç†**ï¼Œ
ç»™ä½ æ‹†ä¸€æ®µï¼š
**â€œè¿™é‡Œç”¨ struct ä»¿å‡½æ•°ï¼Œæ¯”å‡½æ•°æŒ‡é’ˆ / std::function / class æ›´åˆé€‚çš„åœ°æ–¹â€**
