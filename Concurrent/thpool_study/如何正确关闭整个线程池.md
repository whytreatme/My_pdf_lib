# 问  
我看到代码里写着 while(thpool_keepalive)。如果有一天我想关掉整个线程池，我应该怎么做才能让这些正在 bsem_wait 睡觉的线程“寿终正寝”？（提示：只把 thpool_keepalive 改为 false 够吗？它们还在睡觉呢！）  

# 答  
模式识别：哨兵/广播模式 (Signaling)
在工程中，要关闭一个阻塞的线程池，通常有两种做法：
做法 A (信号弹)：连续按下 N次铃铛（bsem_post），让所有线程都醒来。醒来后，它们第一件事就是检查 thpool_keepalive 标志位，发现是 false，就直接 return 结束生命。
做法 B (毒药丸/Poison Pill)：往队列里投递N个特殊的“自杀任务”，线程拿到这个任务就自己退出。