å¾ˆå¥½çš„é—®é¢˜ï¼`key`**ä¸æ˜¯å†…å­˜åœ°å€**ï¼Œè€Œæ˜¯ä¸€ä¸ª**ç³»ç»Ÿçº§çš„æ ‡è¯†ç¬¦**ã€‚è®©æˆ‘ç”¨é€šä¿—çš„æ–¹å¼è§£é‡Šï¼š

## ğŸ”‘ `key` çš„æœ¬è´¨

`key` æ˜¯ä¸€ä¸ª**æ•´æ•°æ ‡è¯†ç¬¦**ï¼Œç”¨äºåœ¨**æ•´ä¸ªæ“ä½œç³»ç»ŸèŒƒå›´å†…**å”¯ä¸€æ ‡è¯†ä¸€ä¸ªSystem V IPCå¯¹è±¡ï¼ˆä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ï¼‰ã€‚

### ç±»æ¯”ç†è§£ï¼š
-     **æ–‡ä»¶å**     â†’ æ–‡ä»¶ç³»ç»Ÿä¸­çš„å”¯ä¸€æ ‡è¯†
    
-     **ç«¯å£å·**     â†’ ç½‘ç»œé€šä¿¡ä¸­çš„å”¯ä¸€æ ‡è¯†
    
-     **keyå€¼**     â†’ System V IPCä¸­çš„å”¯ä¸€æ ‡è¯†

## ğŸ¯ `key` çš„ä¸¤ç§ç”Ÿæˆæ–¹å¼

### 1. **æ‰‹åŠ¨æŒ‡å®š**ï¼ˆç®€å•é¡¹ç›®ï¼‰

```cpp
// ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæ•´æ•°ä½œä¸ºkey
key_t key = 0x5000;    // åå…­è¿›åˆ¶
key_t key = 12345;     // åè¿›åˆ¶

int semid = semget(key, 1, 0666|IPC_CREAT);
```

**é£é™©**ï¼šå¯èƒ½ä¸å…¶ä»–ç¨‹åºå†²çªã€‚

### 2. **ä½¿ç”¨ `ftok()` ç”Ÿæˆ**ï¼ˆæ¨èæ–¹å¼ï¼‰

```cpp
#include <sys/ipc.h>

// é€šè¿‡æ–‡ä»¶è·¯å¾„å’Œé¡¹ç›®IDç”Ÿæˆkey
key_t key = ftok("/tmp/myapp", 'A');
// ç›¸åŒè·¯å¾„å’Œé¡¹ç›®IDæ€»æ˜¯ç”Ÿæˆç›¸åŒçš„key
int semid = semget(key, 1, 0666|IPC_CREAT);
```

## ğŸ’¡ `ftok()` å‡½æ•°è¯¦è§£

```cpp
key_t ftok(const char *pathname, int proj_id);
```
-     `pathname`: ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶è·¯å¾„ï¼ˆé€šå¸¸æ˜¯ç¨‹åºç›¸å…³æ–‡ä»¶ï¼‰
    
-     `proj_id`: é¡¹ç›®æ ‡è¯†å­—ç¬¦ï¼ˆ1å­—èŠ‚ï¼Œ0-255ï¼‰

### ä½¿ç”¨ç¤ºä¾‹ï¼š

```cpp
// ä¸åŒçš„ç»„åˆç”Ÿæˆä¸åŒçš„key
key_t key1 = ftok("/tmp/myapp", 'A');  // ä¿¡å·é‡A
key_t key2 = ftok("/tmp/myapp", 'B');  // ä¿¡å·é‡B
key_t key3 = ftok("/home/user/config", 'A'); // å®Œå…¨ä¸åŒ
```

## ğŸ” å®é™…å·¥ä½œæµç¨‹

### è¿›ç¨‹Aï¼ˆåˆ›å»ºè€…ï¼‰ï¼š

```cpp
// 1. ç”Ÿæˆkey
key_t key = ftok("/tmp/myapp", 'S');

// 2. åˆ›å»ºä¿¡å·é‡
int semid = semget(key, 1, 0666|IPC_CREAT|IPC_EXCL);

// 3. åˆå§‹åŒ–
union semun arg;
arg.val = 1;
semctl(semid, 0, SETVAL, arg);
```

### è¿›ç¨‹Bï¼ˆä½¿ç”¨è€…ï¼‰ï¼š

```cpp
// 1. ä½¿ç”¨ç›¸åŒçš„keyï¼ˆä¸éœ€è¦åˆ›å»ºæ ‡å¿—ï¼‰
key_t key = ftok("/tmp/myapp", 'S');

// 2. è·å–å·²å­˜åœ¨çš„ä¿¡å·é‡
int semid = semget(key, 1, 0666);

// 3. ç›´æ¥ä½¿ç”¨ï¼ˆä¸éœ€è¦åˆå§‹åŒ–ï¼‰
semop(semid, ...);
```

## ğŸ¯ `key` çš„æ ¸å¿ƒä½œç”¨

### 1. **è·¨è¿›ç¨‹æ ‡è¯†**

```cpp
// è¿›ç¨‹Aå’Œè¿›ç¨‹Bä½¿ç”¨ç›¸åŒçš„key
// å°±èƒ½è®¿é—®åŒä¸€ä¸ªä¿¡å·é‡å¯¹è±¡
key_t shared_key = 0x1234;

// è¿›ç¨‹A
int semid_A = semget(shared_key, 1, 0666|IPC_CREAT);

// è¿›ç¨‹B  
int semid_B = semget(shared_key, 1, 0666);
// semid_A == semid_Bï¼Œè®¿é—®åŒä¸€ä¸ªä¿¡å·é‡
```

### 2. **æƒé™æ§åˆ¶**

```cpp
// æœ€å3ä½æ˜¯æƒé™æ ‡å¿—ï¼ˆç±»ä¼¼æ–‡ä»¶æƒé™ï¼‰
int semid = semget(key, 1, 0666|IPC_CREAT);
// 0666 = æ‰€æœ‰ç”¨æˆ·å¯è¯»å†™
```

### 3. **å†²çªé¿å…**

```cpp
// IPC_EXCL ç¡®ä¿å”¯ä¸€æ€§
int semid = semget(key, 1, 0666|IPC_CREAT|IPC_EXCL);
// å¦‚æœå·²å­˜åœ¨ï¼Œä¼šè¿”å›é”™è¯¯
```

## ğŸ”§ æŸ¥çœ‹ç³»ç»Ÿä¸­çš„IPCå¯¹è±¡

```bash
# æŸ¥çœ‹æ‰€æœ‰System Vä¿¡å·é‡
ipcs -s

# è¾“å‡ºç¤ºä¾‹ï¼š
------ Semaphore Arrays --------
key        semid      owner      perms      nsems     
0x00001234 12345      user       666        1
0x00005678 67890      user       666        1
```

è¿™é‡Œçš„ `key` åˆ—å°±æ˜¯ä½ ç¨‹åºä¸­ä½¿ç”¨çš„é‚£ç§keyï¼

## ğŸ’¡ æ€»ç»“
-     **`key`     æ˜¯å…¨å±€æ ‡è¯†ç¬¦**ï¼Œä¸æ˜¯å†…å­˜åœ°å€
    
-     **ç›¸åŒkey â†’ ç›¸åŒIPCå¯¹è±¡**ï¼ˆè·¨è¿›ç¨‹ï¼‰
    
-     **æ¨èä½¿ç”¨ `ftok()`**     ç”Ÿæˆkeyï¼Œé¿å…å†²çª
    
-     **key + è·¯å¾„**     ç¡®ä¿ä¸åŒåº”ç”¨ä½¿ç”¨ä¸åŒçš„IPCå¯¹è±¡

ç°åœ¨æ˜ç™½ä¸ºä»€ä¹ˆä½ çš„ä»£ç ä¸­ä¼šæœ‰ `0x5000` è¿™æ ·çš„keyäº†å—ï¼Ÿå®ƒå°±æ˜¯ç”¨æ¥ç¡®ä¿ä¸åŒè¿›ç¨‹èƒ½è®¿é—®åŒä¸€ä¸ªä¿¡å·é‡çš„"å¯†ç "ï¼